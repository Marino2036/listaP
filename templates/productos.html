<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Lista de Productos</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f3f3f3;
      margin: 0;
      padding: 0;
    }
    header {
      background-color: #333;
      color: white;
      padding: 10px 20px;
      display: flex;
      align-items: center;
    }
    header img {
      height: 40px;
      margin-right: 20px;
    }
    header nav a {
      color: white;
      margin-right: 15px;
      text-decoration: none;
    }
    .container {
      padding: 20px;
    }
    .btn-agregar {
      background-color: #444;
      color: white;
      border: none;
      padding: 10px 15px;
      margin-top: 10px;
      cursor: pointer;
      border-radius: 5px;
    }
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      justify-content: center;
      align-items: center;
    }
    .modal-contenido {
      background: white;
      padding: 20px;
      border-radius: 8px;
      max-width: 400px;
      width: 90%;
    }
    .modal-contenido input, .modal-contenido button {
      width: 100%;
      margin: 5px 0;
      padding: 10px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: left;
    }
    th {
      background-color: #007bff;
      color: white;
    }
  </style>
</head>
<body>
  <header>
    <img src="logo.jpg" alt="Logo">
    <nav>
      <a href="#">Inicio</a>
      <a href="#">Generar PDF</a>
    </nav>
  </header>

  <div class="container">
    <button class="btn-agregar" onclick="document.getElementById('modal').style.display='flex'">‚ûï Agregar producto</button>

    <div id="modal" class="modal">
      <div class="modal-contenido">
        <span style="float:right;cursor:pointer;font-weight:bold" onclick="document.getElementById('modal').style.display='none'">&times;</span>
        <h2>Agregar Producto</h2>
        <form action="/crear" method="post">
          <input type="text" name="nombre" placeholder="Nombre del producto" required>
          <input type="number" name="precio" placeholder="Precio" required>
          <input type="text" name="categoria" placeholder="Categor√≠a" required>
          <input type="text" id="codigo" name="codigo" placeholder="C√≥digo de barras" required>
          <button type="button" onclick="iniciarEscaneo()">üì∑ Escanear</button>
          <button type="submit">Guardar</button>
        </form>
      </div>
    </div>

    <h1>Lista de Productos</h1>
    <input type="text" placeholder="Buscar producto...">
    <button>Buscar</button>

    <h2>Escanear c√≥digo de barras</h2>
    <button style="background-color:#c62828;color:white;padding:10px 15px;border:none;border-radius:4px" onclick="iniciarEscaneo()">Iniciar Esc√°ner</button>

    <table>
      <tr><th>Nombre</th><th>Precio</th><th>Categor√≠a</th><th>Acciones</th></tr>
      <tr><td>Boing 500ml</td><td>$15</td><td>Bebidas</td><td><a href="#">Editar</a></td></tr>
      <tr><td>Boing 250ml</td><td>$9</td><td>Bebidas</td><td><a href="#">Editar</a></td></tr>
      <tr><td>Naranjada 600ml</td><td>$18</td><td>Bebidas</td><td><a href="#">Editar</a></td></tr>
      <tr><td>Frutsi 125ml</td><td>$5</td><td>Bebidas</td><td><a href="#">Editar</a></td></tr>
    </table>
  </div>

  <script>
    async function iniciarEscaneo() {
      if (!('BarcodeDetector' in window)) {
        alert('Tu navegador no soporta escaneo de c√≥digos.');
        return;
      }
      try {
        const constraints = { video: { facingMode: 'environment' } };
        const stream = await navigator.mediaDevices.getUserMedia(constraints);
        const video = document.createElement('video');
        video.srcObject = stream;
        video.setAttribute('playsinline', true);
        video.play();

        const modal = document.createElement('div');
        modal.style.position = 'fixed';
        modal.style.top = 0;
        modal.style.left = 0;
        modal.style.width = '100%';
        modal.style.height = '100%';
        modal.style.background = 'rgba(0,0,0,0.8)';
        modal.style.display = 'flex';
        modal.style.alignItems = 'center';
        modal.style.justifyContent = 'center';
        modal.appendChild(video);
        document.body.appendChild(modal);

        const detector = new BarcodeDetector({ formats: ['ean_13', 'code_128', 'ean_8'] });
        const interval = setInterval(async () => {
          const detections = await detector.detect(video);
          if (detections.length > 0) {
            document.getElementById('codigo').value = detections[0].rawValue;
            clearInterval(interval);
            stream.getTracks().forEach(track => track.stop());
            document.body.removeChild(modal);
          }
        }, 500);
      } catch (e) {
        alert('No se pudo iniciar la c√°mara.');
        console.error(e);
      }
    }
  </script>
</body>
</html>
